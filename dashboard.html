<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Violet Trading Journal</title>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        /* ==========================================
           VIOLET DESIGN SYSTEM - 2025 Modern Dark
           ========================================== */
        :root {
            /* Core Colors */
            --bg-primary: #050507;
            --bg-secondary: #0a0a0f;
            --bg-tertiary: #12121a;
            --bg-elevated: #1a1a25;
            --bg-hover: #252535;
            
            /* Accent Colors - Updated to Violet Theme */
            --accent-primary: #8b5cf6;
            --accent-secondary: #a78bfa;
            --accent-tertiary: #c084fc;
            --accent-success: #00ff88;
            --accent-warning: #ffaa00;
            --accent-danger: #ff0044;
            
            /* Text Colors */
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --text-tertiary: #606070;
            --text-muted: #404050;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
            --gradient-success: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            --gradient-danger: linear-gradient(135deg, #ff0044 0%, #cc0036 100%);
            --gradient-glow: linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(167, 139, 250, 0.15) 100%);
            
            /* Effects */
            --glow-primary: 0 0 20px rgba(139, 92, 246, 0.3);
            --glow-success: 0 0 20px rgba(0, 255, 136, 0.3);
            --glow-danger: 0 0 20px rgba(255, 0, 68, 0.3);
            --shadow-elevated: 0 8px 32px rgba(0, 0, 0, 0.4);
            
            /* Spacing */
            --space-xs: 0.5rem;
            --space-sm: 0.75rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Border Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-base: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-elevated);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* Selection */
        ::selection {
            background: rgba(139, 92, 246, 0.3);
            color: var(--text-primary);
        }

        /* ==========================================
           LOADING SCREEN - Optimized
           ========================================== */
        #loading-screen {
            position: fixed;
            inset: 0;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }

        #loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .loader-container {
            position: relative;
            width: 100px;
            height: 100px;
        }

        .loader-ring {
            position: absolute;
            inset: 0;
            border: 2px solid transparent;
            border-radius: 50%;
            animation: rotate 1.5s linear infinite;
        }

        .loader-ring:nth-child(1) {
            border-top-color: var(--accent-primary);
            animation-duration: 1s;
        }

        .loader-ring:nth-child(2) {
            border-right-color: var(--accent-secondary);
            animation-duration: 1.5s;
            animation-direction: reverse;
            margin: 8px;
        }

        .loader-ring:nth-child(3) {
            border-bottom-color: var(--accent-tertiary);
            animation-duration: 2s;
            margin: 16px;
        }

        .loader-core {
            position: absolute;
            inset: 28px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 800;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes rotate {
            to { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(0.95); opacity: 0.8; }
        }

        .loading-text {
            margin-top: var(--space-lg);
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .loading-subtext {
            margin-top: var(--space-xs);
            font-size: 0.8rem;
            color: var(--text-tertiary);
        }

        /* ==========================================
           LAYOUT STRUCTURE
           ========================================== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* ==========================================
           SIDEBAR - Glassmorphism Neo
           ========================================== */
        .sidebar {
            width: 260px;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            position: fixed;
            height: 100vh;
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: transform var(--transition-base);
        }

        .sidebar-header {
            padding: var(--space-lg) var(--space-xl);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            cursor: pointer;
            transition: transform var(--transition-fast);
        }

        .brand:hover {
            transform: translateX(4px);
        }

        .brand-icon {
            width: 44px;
            height: 44px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            position: relative;
            overflow: hidden;
        }

        .brand-icon::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .brand:hover .brand-icon::before {
            transform: translateX(100%);
        }

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .brand-name {
            font-size: 1.1rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }

        .brand-tagline {
            font-size: 0.7rem;
            color: var(--text-tertiary);
            font-weight: 500;
            letter-spacing: 1px;
        }

        .sidebar-nav {
            flex: 1;
            padding: var(--space-md);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .nav-section {
            margin-bottom: var(--space-md);
        }

        .nav-label {
            font-size: 0.65rem;
            font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            padding: 0 var(--space-md);
            margin-bottom: var(--space-xs);
        }

        .nav-items {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 0;
            background: var(--gradient-primary);
            border-radius: 0 4px 4px 0;
            transition: height var(--transition-fast);
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.03);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: rgba(139, 92, 246, 0.1);
            color: var(--accent-primary);
        }

        .nav-item.active::before {
            height: 60%;
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 1rem;
            transition: transform var(--transition-fast);
        }

        .nav-item:hover i {
            transform: scale(1.1);
        }

        .nav-badge {
            margin-left: auto;
            background: var(--accent-tertiary);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: var(--radius-full);
        }

        .sidebar-footer {
            padding: var(--space-md);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            margin-top: auto;
        }

        .user-mini {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: var(--bg-elevated);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .user-mini:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            position: relative;
        }

        .user-avatar::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: var(--radius-full);
            background: var(--gradient-primary);
            z-index: -1;
            opacity: 0.5;
            filter: blur(6px);
        }

        .user-info {
            flex: 1;
            min-width: 0;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-status {
            font-size: 0.7rem;
            color: var(--accent-success);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .user-status::before {
            content: '';
            width: 6px;
            height: 6px;
            background: var(--accent-success);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--accent-success);
        }

        /* ==========================================
           MAIN CONTENT
           ========================================== */
        .main-content {
            flex: 1;
            margin-left: 260px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ==========================================
           TOP HEADER
           ========================================== */
        .top-header {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(5, 5, 7, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            padding: var(--space-md) var(--space-xl);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-xl);
            height: 64px;
        }

        .header-search {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input-wrapper i {
            position: absolute;
            left: var(--space-md);
            color: var(--text-tertiary);
            transition: color var(--transition-fast);
        }

        .search-input {
            width: 100%;
            padding: var(--space-sm) var(--space-md) var(--space-sm) 2.5rem;
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-full);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: inherit;
            transition: all var(--transition-fast);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            background: var(--bg-hover);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .search-input:focus + i {
            color: var(--accent-primary);
        }

        .search-input::placeholder {
            color: var(--text-tertiary);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .header-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .header-btn.active {
            background: rgba(139, 92, 246, 0.1);
            color: var(--accent-primary);
            border-color: rgba(139, 92, 246, 0.3);
        }

        .header-btn .indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: var(--accent-tertiary);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--accent-tertiary);
        }

        /* Profile Dropdown */
        .profile-dropdown-container {
            position: relative;
        }

        .profile-trigger {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .profile-trigger:hover {
            background: var(--bg-hover);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .profile-avatar {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
        }

        .profile-meta {
            display: flex;
            flex-direction: column;
            line-height: 1.3;
        }

        .profile-name {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .profile-role {
            font-size: 0.7rem;
            color: var(--text-tertiary);
        }

        .profile-trigger i {
            color: var(--text-tertiary);
            font-size: 0.75rem;
            transition: transform var(--transition-fast);
        }

        .profile-dropdown-container.active .profile-trigger i {
            transform: rotate(180deg);
        }

        .profile-dropdown {
            position: absolute;
            top: calc(100% + var(--space-sm));
            right: 0;
            width: 280px;
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-elevated);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all var(--transition-base);
            z-index: 1000;
            overflow: hidden;
        }

        .profile-dropdown-container.active .profile-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            padding: var(--space-lg);
            background: var(--gradient-glow);
            position: relative;
            overflow: hidden;
        }

        .dropdown-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        .dropdown-user {
            position: relative;
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .dropdown-avatar {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 700;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-info h4 {
            font-size: 1rem;
            margin-bottom: 2px;
        }

        .dropdown-info span {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .app-switcher-section {
            padding: var(--space-sm);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .app-switcher-label {
            font-size: 0.7rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--space-xs);
            padding: 0 var(--space-sm);
        }

        .app-switcher {
            display: flex;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 3px;
        }

        .app-option {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
            padding: var(--space-sm);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .app-option:hover {
            color: var(--text-primary);
        }

        .app-option.active {
            background: var(--bg-elevated);
            color: var(--accent-primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .dropdown-menu {
            list-style: none;
            padding: var(--space-xs);
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .dropdown-item i {
            width: 18px;
            text-align: center;
            color: var(--text-tertiary);
            transition: color var(--transition-fast);
        }

        .dropdown-item:hover i {
            color: var(--accent-primary);
        }

        .dropdown-item.danger {
            color: var(--accent-danger);
        }

        .dropdown-item.danger i {
            color: var(--accent-danger);
        }

        .dropdown-item.danger:hover {
            background: rgba(255, 0, 68, 0.1);
        }

        /* Language Selector */
        .lang-selector {
            margin-left: auto;
            display: flex;
            gap: 3px;
            background: var(--bg-secondary);
            padding: 2px;
            border-radius: var(--radius-sm);
        }

        .lang-btn {
            padding: 3px 6px;
            border: none;
            background: transparent;
            color: var(--text-tertiary);
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 3px;
            transition: all var(--transition-fast);
        }

        .lang-btn.active {
            background: var(--accent-primary);
            color: var(--bg-primary);
        }

        /* ==========================================
           CONTENT SECTIONS
           ========================================== */
        .content-wrapper {
            flex: 1;
            padding: var(--space-lg);
            overflow-y: auto;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            margin-bottom: var(--space-lg);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: var(--space-xs);
            background: linear-gradient(to right, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* ==========================================
           STATS GRID
           ========================================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            position: relative;
            overflow: hidden;
            transition: all var(--transition-base);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-elevated);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card.win { --card-accent: var(--accent-success); }
        .stat-card.loss { --card-accent: var(--accent-danger); }
        .stat-card.neutral { --card-accent: var(--accent-primary); }

        .stat-card.win::before { background: var(--gradient-success); }
        .stat-card.loss::before { background: var(--gradient-danger); }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: var(--card-accent, var(--accent-primary));
            transition: all var(--transition-base);
        }

        .stat-card:hover .stat-icon {
            background: var(--card-accent, var(--accent-primary));
            color: var(--bg-primary);
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--card-accent, var(--accent-primary));
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: var(--space-xs);
            letter-spacing: -1px;
        }

        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.05);
        }

        .stat-change.positive {
            color: var(--accent-success);
            background: rgba(0, 255, 136, 0.1);
        }

        .stat-change.negative {
            color: var(--accent-danger);
            background: rgba(255, 0, 68, 0.1);
        }

        /* ==========================================
           CHARTS GRID
           ========================================== */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .chart-card {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            transition: all var(--transition-base);
        }

        .chart-card:hover {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-md);
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .chart-title i {
            color: var(--accent-primary);
        }

        .chart-filter {
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            cursor: pointer;
            appearance: none;
            padding-right: 1.5rem;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%238b5cf6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
        }

        .chart-filter:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        /* ApexCharts Tooltip Fix */
        .apexcharts-tooltip {
            background: var(--bg-elevated) !important;
            border-color: rgba(255, 255, 255, 0.1) !important;
            color: var(--text-primary) !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
        }

        .apexcharts-tooltip-title {
            background: var(--bg-secondary) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: var(--text-primary) !important;
            font-family: 'Plus Jakarta Sans', sans-serif !important;
        }

        .apexcharts-text {
            fill: var(--text-secondary) !important;
        }

        .apexcharts-gridline {
            stroke: rgba(255, 255, 255, 0.05) !important;
        }

        .apexcharts-legend-text {
            color: var(--text-secondary) !important;
        }

        /* ==========================================
           DATA TABLE
           ========================================== */
        .table-container {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--space-lg);
        }

        .table-header {
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1rem;
            font-weight: 700;
        }

        .btn-primary {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-md);
            background: var(--gradient-primary);
            color: var(--bg-primary);
            border: none;
            border-radius: var(--radius-full);
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.6s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-primary);
        }

        .table-wrapper {
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .data-table th {
            text-align: left;
            padding: var(--space-sm) var(--space-lg);
            color: var(--text-tertiary);
            font-weight: 600;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            white-space: nowrap;
        }

        .data-table td {
            padding: var(--space-sm) var(--space-lg);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .data-table tbody tr {
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .data-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-win {
            background: rgba(0, 255, 136, 0.15);
            color: var(--accent-success);
        }

        .badge-loss {
            background: rgba(255, 0, 68, 0.15);
            color: var(--accent-danger);
        }

        .badge-breakeven {
            background: rgba(255, 170, 0, 0.15);
            color: var(--accent-warning);
        }

        .badge-side {
            padding: 2px 6px;
            font-size: 0.65rem;
        }

        .badge-buy {
            background: rgba(139, 92, 246, 0.15);
            color: var(--accent-primary);
        }

        .badge-sell {
            background: var(--accent-tertiary);
            color: white;
        }

        .pnl-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .pnl-positive { color: var(--accent-success); }
        .pnl-negative { color: var(--accent-danger); }

        .action-btns {
            display: flex;
            gap: var(--space-xs);
        }

        .btn-icon {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-md);
            border: none;
            background: transparent;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
        }

        .btn-icon.edit:hover {
            background: rgba(139, 92, 246, 0.1);
            color: var(--accent-primary);
        }

        .btn-icon.delete:hover {
            background: rgba(255, 0, 68, 0.1);
            color: var(--accent-danger);
        }

        /* ==========================================
           CALENDAR
           ========================================== */
        .calendar-card {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
        }

        .calendar-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .calendar-nav-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-nav-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: rgba(255, 255, 255, 0.15);
        }

        .calendar-month {
            font-size: 1.1rem;
            font-weight: 700;
            min-width: 180px;
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: var(--space-xs);
        }

        .calendar-day-header {
            text-align: center;
            padding: var(--space-sm);
            color: var(--text-tertiary);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.02);
            border-radius: var(--radius-md);
            padding: var(--space-xs);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 1px solid transparent;
            display: flex;
            flex-direction: column;
            min-height: 60px;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .calendar-day.other-month {
            opacity: 0.3;
            cursor: default;
        }

        .calendar-day.other-month:hover {
            transform: none;
            border-color: transparent;
        }

        .calendar-day.today {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 1px var(--accent-primary);
        }

        .calendar-day.win {
            background: rgba(0, 255, 136, 0.08);
            border-color: rgba(0, 255, 136, 0.2);
        }

        .calendar-day.win:hover {
            background: rgba(0, 255, 136, 0.12);
        }

        .calendar-day.loss {
            background: rgba(255, 0, 68, 0.08);
            border-color: rgba(255, 0, 68, 0.2);
        }

        .calendar-day.loss:hover {
            background: rgba(255, 0, 68, 0.12);
        }

        .day-number {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: auto;
        }

        .day-pnl {
            font-size: 0.7rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .day-pnl.positive { color: var(--accent-success); }
        .day-pnl.negative { color: var(--accent-danger); }

        /* ==========================================
           MODALS
           ========================================== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-lg);
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-base);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transform: scale(0.95) translateY(20px);
            transition: transform var(--transition-base);
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            padding: var(--space-lg);
            background: var(--gradient-glow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .modal-title {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .modal-title i {
            color: var(--accent-primary);
        }

        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: var(--space-lg);
            overflow-y: auto;
            flex: 1;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: var(--space-sm);
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
            transition: all var(--transition-fast);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-input::placeholder,
        .form-textarea::placeholder {
            color: var(--text-tertiary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .modal-footer {
            padding: var(--space-md) var(--space-lg);
            background: var(--bg-elevated);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .btn-secondary {
            padding: var(--space-sm) var(--space-md);
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border-radius: var(--radius-full);
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Detail Modal */
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
        }

        .detail-item {
            background: var(--bg-elevated);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .detail-item.full-width {
            grid-column: 1 / -1;
        }

        .detail-label {
            font-size: 0.7rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--space-xs);
        }

        .detail-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .detail-value.positive { color: var(--accent-success); }
        .detail-value.negative { color: var(--accent-danger); }

        .detail-images {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            margin-top: var(--space-xs);
        }

        .detail-image-link {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-sm) var(--space-md);
            background: var(--gradient-primary);
            color: var(--bg-primary);
            text-decoration: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.85rem;
            transition: all var(--transition-fast);
        }

        .detail-image-link:hover {
            transform: translateY(-2px);
            box-shadow: var(--glow-primary);
        }

        .detail-note {
            background: var(--bg-primary);
            padding: var(--space-md);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.05);
            line-height: 1.6;
            color: var(--text-secondary);
            white-space: pre-wrap;
            font-size: 0.9rem;
        }

        /* ==========================================
           ANALYTICS SECTION
           ========================================== */
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
            transition: all var(--transition-base);
        }

        .metric-card:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .metric-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto var(--space-sm);
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: var(--accent-primary);
            transition: all var(--transition-base);
        }

        .metric-card:hover .metric-icon {
            background: var(--accent-primary);
            color: var(--bg-primary);
            transform: scale(1.05);
            box-shadow: var(--glow-primary);
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: var(--space-xs);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
        }

        /* ==========================================
           PROJECTS/GOALS
           ========================================== */
        .projects-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-md);
        }

        .project-card {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            transition: all var(--transition-base);
        }

        .project-card:hover {
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-elevated);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }

        .project-title {
            font-size: 1rem;
            font-weight: 700;
        }

        .project-status {
            padding: 3px 10px;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .project-status.active {
            background: rgba(0, 255, 136, 0.15);
            color: var(--accent-success);
        }

        .project-status.pending {
            background: rgba(255, 170, 0, 0.15);
            color: var(--accent-warning);
        }

        .project-desc {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: var(--space-md);
            line-height: 1.5;
        }

        .targets-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
            margin-bottom: var(--space-md);
        }

        .target-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: var(--bg-elevated);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .target-item:hover {
            background: var(--bg-hover);
        }

        .target-checkbox {
            width: 18px;
            height: 18px;
            border: 2px solid var(--text-tertiary);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .target-item.completed .target-checkbox {
            background: var(--accent-success);
            border-color: var(--accent-success);
        }

        .target-item.completed .target-checkbox::after {
            content: '';
            color: var(--bg-primary);
            font-size: 0.7rem;
            font-weight: 700;
        }

        .target-text {
            flex: 1;
            font-size: 0.85rem;
            transition: all var(--transition-fast);
        }

        .target-item.completed .target-text {
            text-decoration: line-through;
            color: var(--text-tertiary);
        }

        .project-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--space-md);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .progress-info {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .progress-bar {
            width: 80px;
            height: 5px;
            background: var(--bg-elevated);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 3px;
            transition: width var(--transition-slow);
        }

        /* ==========================================
           SETTINGS
           ========================================== */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: var(--space-md);
        }

        .settings-card {
            background: var(--bg-secondary);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
        }

        .settings-card-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .settings-card-title i {
            color: var(--accent-primary);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .setting-info p {
            font-size: 0.8rem;
            color: var(--text-tertiary);
        }

        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 44px;
            height: 24px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--bg-elevated);
            border-radius: 34px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition-fast);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 18px;
            width: 18px;
            left: 2px;
            bottom: 2px;
            background: var(--text-secondary);
            border-radius: 50%;
            transition: var(--transition-fast);
        }

        input:checked + .toggle-slider {
            background: rgba(139, 92, 246, 0.2);
            border-color: var(--accent-primary);
        }

        input:checked + .toggle-slider::before {
            transform: translateX(20px);
            background: var(--accent-primary);
        }

        /* ==========================================
           EMPTY STATES
           ========================================== */
        .empty-state {
            text-align: center;
            padding: var(--space-2xl);
            color: var(--text-tertiary);
        }

        .empty-state-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto var(--space-md);
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--accent-primary);
        }

        .empty-state h3 {
            color: var(--text-secondary);
            margin-bottom: var(--space-xs);
            font-size: 1.1rem;
        }

        .empty-state p {
            font-size: 0.9rem;
        }

        /* ==========================================
           NOTIFICATIONS
           ========================================== */
        .notification-container {
            position: fixed;
            top: var(--space-lg);
            right: var(--space-lg);
            z-index: 99999;
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .notification {
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-left: 3px solid var(--accent-primary);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            min-width: 280px;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            box-shadow: var(--shadow-elevated);
            animation: slideInRight 0.3s ease;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .notification.success { border-left-color: var(--accent-success); }
        .notification.error { border-left-color: var(--accent-danger); }
        .notification.warning { border-left-color: var(--accent-warning); }

        .notification-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .notification.success .notification-icon {
            background: rgba(0, 255, 136, 0.15);
            color: var(--accent-success);
        }

        .notification.error .notification-icon {
            background: rgba(255, 0, 68, 0.15);
            color: var(--accent-danger);
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 2px;
            font-size: 0.9rem;
        }

        .notification-message {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* ==========================================
           RESPONSIVE
           ========================================== */
        @media (max-width: 1200px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid,
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }
            
            .projects-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Utility Classes */
        .text-gradient {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Profile Dropdown in Sidebar Footer */
        .sidebar-footer .profile-dropdown-container {
            position: relative;
        }

        .sidebar-footer .profile-dropdown {
            position: absolute;
            bottom: calc(100% + 10px);
            top: auto;
            left: 0;
            right: 0;
            width: 240px;
            background: var(--bg-elevated);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-elevated);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all var(--transition-base);
            z-index: 1000;
            overflow: hidden;
        }

        .sidebar-footer .profile-dropdown-container.active .profile-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .sidebar-footer .profile-dropdown-container.active .user-mini .fa-chevron-right {
            transform: rotate(90deg);
        }

        .sidebar-footer .user-mini {
            position: relative;
        }

        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-elevated) 25%, var(--bg-hover) 50%, var(--bg-elevated) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius-md);
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 1em;
            margin-bottom: 0.5em;
        }

        .skeleton-title {
            height: 1.5em;
            width: 60%;
            margin-bottom: 1em;
        }
    </style>
<base target="_blank">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader-container">
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div class="loader-ring"></div>
            <div class="loader-core">V</div>
        </div>
        <div class="loading-text" data-i18n="loading">Initializing Violet</div>
        <div class="loading-subtext" data-i18n="loadingSub">Loading your trading data...</div>
    </div>

    <!-- Notifications -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand" onclick="window.location.href='index.html'">
                    <div class="brand-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="brand-text">
                        <span class="brand-name">VIOLET</span>
                        <span class="brand-tagline">Trading Journal</span>
                    </div>
                </div>
            </div>

            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-label" data-i18n="menu">Menu</div>
                    <ul class="nav-items">
                        <li class="nav-item active" data-section="dashboard" data-content="dashboard-content">
                            <i class="fas fa-th-large"></i>
                            <span data-i18n="dashboard">Dashboard</span>
                        </li>
                        <li class="nav-item" data-section="analytics" data-content="analytics-content">
                            <i class="fas fa-chart-pie"></i>
                            <span data-i18n="analytics">Analytics</span>
                        </li>
                        <li class="nav-item" data-section="projects" data-content="projects-content">
                            <i class="fas fa-bullseye"></i>
                            <span data-i18n="goals">Targets</span>
                        </li>
                    </ul>
                </div>

                <div class="nav-section">
                    <div class="nav-label" data-i18n="system">System</div>
                    <ul class="nav-items">
                        <li class="nav-item" data-section="settings" data-content="settings-content">
                            <i class="fas fa-cog"></i>
                            <span data-i18n="settings">Settings</span>
                        </li>
                    </ul>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="profile-dropdown-container" id="profileDropdownContainer">
                    <div class="user-mini" onclick="toggleProfileDropdown()">
                        <div class="user-avatar" id="sidebarAvatar">TJ</div>
                        <div class="user-info">
                            <div class="user-name" id="sidebarName">Trader</div>
                            <div class="user-status" data-i18n="online">Online</div>
                        </div>
                        <i class="fas fa-chevron-right" style="color: var(--text-tertiary); font-size: 0.75rem; transition: transform 0.3s ease;"></i>
                    </div>

                    <div class="profile-dropdown" style="bottom: calc(100% + 10px); top: auto;">
                        <div class="dropdown-header">
                            <div class="dropdown-user">
                                <div class="dropdown-avatar" id="dropdownAvatar">TJ</div>
                                <div class="dropdown-info">
                                    <h4 id="dropdownName">Trader</h4>
                                    <span id="dropdownEmail">trader@violet.com</span>
                                </div>
                            </div>
                        </div>

                        <div class="app-switcher-section">
                            <div class="app-switcher-label" data-i18n="switchApp">Switch Application</div>
                            <div class="app-switcher">
                                <div class="app-option active" onclick="switchApp('trading')">
                                    <i class="fas fa-chart-line"></i>
                                    <span data-i18n="trading">Trading</span>
                                </div>
                                <div class="app-option" onclick="switchApp('budget')">
                                    <i class="fas fa-wallet"></i>
                                    <span data-i18n="budget">Budget</span>
                                </div>
                            </div>
                        </div>

                        <ul class="dropdown-menu">
                            <li class="dropdown-item" onclick="switchSection('settings', 'settings-content')">
                                <i class="fas fa-cog"></i>
                                <span data-i18n="settings">Settings</span>
                            </li>
                            <li class="dropdown-item" onclick="toggleLanguage()">
                                <i class="fas fa-globe"></i>
                                <span data-i18n="language">Language</span>
                                <div class="lang-selector">
                                    <button class="lang-btn active" id="lang-en">EN</button>
                                    <button class="lang-btn" id="lang-id">ID</button>
                                </div>
                            </li>
                        </ul>

                        <div style="border-top: 1px solid rgba(255,255,255,0.05);">
                            <ul class="dropdown-menu">
                                <li class="dropdown-item danger" onclick="logout()">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span data-i18n="logout">Logout</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Header -->
            <header class="top-header">
                <div style="font-size: 1rem; font-weight: 700; color: var(--text-secondary);">
                    <span id="pageTitle">Dashboard</span>
                </div>
            </header>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Dashboard Section -->
                <div id="dashboard-content" class="content-section active">
                    <div class="section-header">
                        <h1 class="section-title" data-i18n="dashboardTitle">Dashboard Overview</h1>
                        <p class="section-subtitle" data-i18n="dashboardSubtitle">Track your trading performance in real-time</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card neutral">
                            <div class="stat-header">
                                <span class="stat-label" data-i18n="totalTrades">Total Trades</span>
                                <div class="stat-icon"><i class="fas fa-exchange-alt"></i></div>
                            </div>
                            <div class="stat-value mono" id="totalTrades">0</div>
                            <span class="stat-change" id="totalTradesTrend">0 trades</span>
                        </div>

                        <div class="stat-card win">
                            <div class="stat-header">
                                <span class="stat-label" data-i18n="winRate">Win Rate</span>
                                <div class="stat-icon"><i class="fas fa-trophy"></i></div>
                            </div>
                            <div class="stat-value mono" id="winRate">0%</div>
                            <span class="stat-change positive" id="winRateTrend">-</span>
                        </div>

                        <div class="stat-card" id="pnlCard">
                            <div class="stat-header">
                                <span class="stat-label" data-i18n="totalPnL">Total P&L</span>
                                <div class="stat-icon"><i class="fas fa-dollar-sign"></i></div>
                            </div>
                            <div class="stat-value mono" id="totalPnL">$0</div>
                            <span class="stat-change" id="pnlTrend">$0</span>
                        </div>

                        <div class="stat-card neutral">
                            <div class="stat-header">
                                <span class="stat-label" data-i18n="profitFactor">Profit Factor</span>
                                <div class="stat-icon"><i class="fas fa-balance-scale"></i></div>
                            </div>
                            <div class="stat-value mono" id="profitFactor">-</div>
                            <span class="stat-change" data-i18n="riskRatio">Risk Ratio</span>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card full-width">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="fas fa-chart-area"></i>
                                    <span data-i18n="performanceChart">Performance Overview</span>
                                </h3>
                                <select class="chart-filter" id="statsFilter" onchange="updateCharts()">
                                    <option value="7" data-i18n="last7Days">Last 7 Days</option>
                                    <option value="30" data-i18n="last30Days">Last 30 Days</option>
                                    <option value="90" data-i18n="last3Months">Last 3 Months</option>
                                    <option value="365" data-i18n="thisYear">This Year</option>
                                </select>
                            </div>
                            <div id="mainChart"></div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="fas fa-coins"></i>
                                    <span data-i18n="topSymbols">Top Symbols</span>
                                </h3>
                            </div>
                            <div id="symbolsChart"></div>
                        </div>

                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="fas fa-percentage"></i>
                                    <span data-i18n="winLossRatio">Win/Loss Distribution</span>
                                </h3>
                            </div>
                            <div id="distributionChart"></div>
                        </div>
                    </div>

                    <div class="table-container">
                        <div class="table-header">
                            <h3 class="table-title" data-i18n="recentTrades">Recent Trades</h3>
                            <button class="btn-primary" onclick="openTradeModal()">
                                <i class="fas fa-plus"></i>
                                <span data-i18n="addTrade">Add Trade</span>
                            </button>
                        </div>
                        <div class="table-wrapper" id="tradesTableContainer">
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-history"></i>
                                </div>
                                <h3 data-i18n="noTrades">No trades yet</h3>
                                <p data-i18n="startTrading">Add your first trade to get started</p>
                            </div>
                        </div>
                    </div>

                    <div class="calendar-card">
                        <div class="calendar-toolbar">
                            <h3 class="chart-title">
                                <i class="fas fa-calendar-alt"></i>
                                <span data-i18n="tradingCalendar">Trading Calendar</span>
                            </h3>
                            <div class="calendar-nav">
                                <button class="calendar-nav-btn" onclick="changeMonth(-1)">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <span class="calendar-month" id="calendarMonth">February 2025</span>
                                <button class="calendar-nav-btn" onclick="changeMonth(1)">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="calendar-grid" id="calendarGrid"></div>
                    </div>
                </div>

                <!-- Analytics Section -->
                <div id="analytics-content" class="content-section">
                    <div class="section-header">
                        <h1 class="section-title" data-i18n="analyticsTitle">Advanced Analytics</h1>
                        <p class="section-subtitle" data-i18n="analyticsSubtitle">Deep dive into your trading metrics</p>
                    </div>

                    <div class="metrics-row">
                        <div class="metric-card">
                            <div class="metric-icon"><i class="fas fa-arrow-trend-up"></i></div>
                            <div class="metric-label" data-i18n="avgWin">Avg Win</div>
                            <div class="metric-value mono" id="avgWin">$0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"><i class="fas fa-arrow-trend-down"></i></div>
                            <div class="metric-label" data-i18n="avgLoss">Avg Loss</div>
                            <div class="metric-value mono" id="avgLoss">$0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"><i class="fas fa-calculator"></i></div>
                            <div class="metric-label" data-i18n="expectancy">Expectancy</div>
                            <div class="metric-value mono" id="expectancy">$0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-icon"><i class="fas fa-chart-line"></i></div>
                            <div class="metric-label" data-i18n="maxDrawdown">Max Drawdown</div>
                            <div class="metric-value mono" id="maxDrawdown">$0</div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="fas fa-wave-square"></i>
                                    <span data-i18n="equityCurve">Equity Curve</span>
                                </h3>
                            </div>
                            <div id="equityChart"></div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="fas fa-chart-bar"></i>
                                    <span data-i18n="monthlyPerformance">Monthly Performance</span>
                                </h3>
                            </div>
                            <div id="monthlyChart"></div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="fas fa-clock"></i>
                                    <span data-i18n="performanceByDay">Performance by Day</span>
                                </h3>
                            </div>
                            <div id="dayChart"></div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">
                                    <i class="fas fa-crosshairs"></i>
                                    <span data-i18n="riskReward">Risk:Reward Analysis</span>
                                </h3>
                            </div>
                            <div id="rrChart"></div>
                        </div>
                    </div>
                </div>

                <!-- Projects/Goals Section -->
                <div id="projects-content" class="content-section">
                    <div class="projects-toolbar">
                        <div class="section-header" style="margin: 0;">
                            <h1 class="section-title" data-i18n="goalsTitle">Trading Goals</h1>
                            <p class="section-subtitle" data-i18n="goalsSubtitle">Set and track your trading targets</p>
                        </div>
                        <button class="btn-primary" onclick="openProjectModal()">
                            <i class="fas fa-plus"></i>
                            <span data-i18n="addGoal">Add Goal</span>
                        </button>
                    </div>

                    <div class="projects-grid" id="projectsGrid">
                        <div class="empty-state" style="grid-column: 1/-1;">
                            <div class="empty-state-icon">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <h3 data-i18n="noGoals">No goals set yet</h3>
                            <p data-i18n="createGoal">Create your first trading goal</p>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-content" class="content-section">
                    <div class="section-header">
                        <h1 class="section-title" data-i18n="settingsTitle">Settings</h1>
                        <p class="section-subtitle" data-i18n="settingsSubtitle">Customize your experience</p>
                    </div>

                    <div class="settings-grid">
                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-globe"></i>
                                <span data-i18n="localization">Localization</span>
                            </h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4 data-i18n="language">Language</h4>
                                    <p data-i18n="languageDesc">Choose your preferred language</p>
                                </div>
                                <div class="lang-selector" style="margin: 0;">
                                    <button class="lang-btn active" onclick="setLanguage('en')" id="settings-lang-en">EN</button>
                                    <button class="lang-btn" onclick="setLanguage('id')" id="settings-lang-id">ID</button>
                                </div>
                            </div>
                        </div>

                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-bell"></i>
                                <span data-i18n="notifications">Notifications</span>
                            </h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4 data-i18n="tradeAlerts">Trade Alerts</h4>
                                    <p data-i18n="tradeAlertsDesc">Show notifications for new trades</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" checked id="notifToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div class="settings-card">
                            <h3 class="settings-card-title">
                                <i class="fas fa-shield-alt"></i>
                                <span data-i18n="privacy">Privacy & Security</span>
                            </h3>
                            <div class="setting-item">
                                <div class="setting-info">
                                    <h4 data-i18n="session">Session</h4>
                                    <p data-i18n="sessionDesc">Manage your active session</p>
                                </div>
                                <button class="btn-secondary" onclick="logout()" style="padding: var(--space-sm) var(--space-md);">
                                    <i class="fas fa-sign-out-alt"></i> <span data-i18n="logout">Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Trade Modal -->
    <div class="modal-overlay" id="tradeModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-plus-circle"></i>
                    <span id="tradeModalTitle" data-i18n="addTrade">Add Trade</span>
                </h2>
                <button class="modal-close" onclick="closeTradeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="tradeForm" onsubmit="saveTrade(event)">
                <div class="modal-body">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-i18n="result">Result *</label>
                            <select class="form-select" name="result" required>
                                <option value="" data-i18n="selectResult">Select Result</option>
                                <option value="WIN">WIN</option>
                                <option value="LOSS">LOSS</option>
                                <option value="BREAKEVEN">BREAKEVEN</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="symbol">Symbol *</label>
                            <input type="text" class="form-input" name="symbol" placeholder="XAUUSD" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="openDate">Open Date *</label>
                            <input type="datetime-local" class="form-input" name="open_date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="type">Type *</label>
                            <select class="form-select" name="type" required>
                                <option value="" data-i18n="selectType">Select Type</option>
                                <option value="forex">Forex</option>
                                <option value="crypto">Crypto</option>
                                <option value="stock">Stock</option>
                                <option value="commodity">Commodity</option>
                                <option value="indices">Indices</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="side">Side *</label>
                            <select class="form-select" name="side" required>
                                <option value="" data-i18n="selectSide">Select Side</option>
                                <option value="buy">BUY</option>
                                <option value="sell">SELL</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="timeFrame">Time Frame</label>
                            <select class="form-select" name="time_frame">
                                <option value="" data-i18n="selectTF">Select TF</option>
                                <option value="M1">M1</option>
                                <option value="M5">M5</option>
                                <option value="M15">M15</option>
                                <option value="M30">M30</option>
                                <option value="H1">H1</option>
                                <option value="H4">H4</option>
                                <option value="D1">D1</option>
                                <option value="W1">W1</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="riskReward">Risk:Reward</label>
                            <select class="form-select" name="risk_reward">
                                <option value="" data-i18n="selectRR">Select R:R</option>
                                <option value="1:1">1:1</option>
                                <option value="1:2">1:2</option>
                                <option value="1:3">1:3</option>
                                <option value="1:4">1:4</option>
                                <option value="1:5">1:5+</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="pnl">P&L (USD) *</label>
                            <input type="number" class="form-input" name="pnl" step="0.01" placeholder="0.00" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="imageBefore">Screenshot Before</label>
                            <input type="url" class="form-input" name="image_before" placeholder="https://...">
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="imageAfter">Screenshot After</label>
                            <input type="url" class="form-input" name="image_after" placeholder="https://...">
                        </div>
                        <div class="form-group full-width">
                            <label class="form-label" data-i18n="note">Note / Analysis</label>
                            <textarea class="form-textarea" name="note" placeholder="Enter your trade analysis..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeTradeModal()" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i>
                        <span data-i18n="saveTrade">Save Trade</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Trade Detail Modal -->
    <div class="modal-overlay" id="detailModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-eye"></i>
                    <span data-i18n="tradeDetails">Trade Details</span>
                </h2>
                <button class="modal-close" onclick="closeDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="detailContent">
                <!-- Dynamic content -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeDetailModal()" data-i18n="close">Close</button>
                <button type="button" class="btn-primary" onclick="editCurrentTrade()">
                    <i class="fas fa-edit"></i>
                    <span data-i18n="editTrade">Edit Trade</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal-overlay" id="projectModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-bullseye"></i>
                    <span id="projectModalTitle" data-i18n="addGoal">Add Goal</span>
                </h2>
                <button class="modal-close" onclick="closeProjectModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="projectForm" onsubmit="saveProject(event)">
                <div class="modal-body">
                    <div class="form-grid" style="grid-template-columns: 1fr;">
                        <div class="form-group">
                            <label class="form-label" data-i18n="goalTitle">Goal Title *</label>
                            <input type="text" class="form-input" name="title" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="description">Description</label>
                            <textarea class="form-textarea" name="description" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" data-i18n="targets">Targets (one per line)</label>
                            <textarea class="form-textarea" name="targets" rows="4" placeholder="Target 1&#10;Target 2&#10;Target 3"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeProjectModal()" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i>
                        <span data-i18n="saveGoal">Save Goal</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ==========================================
        // CONFIGURATION
        // ==========================================
        const CONFIG = {
            supabaseUrl: 'https://bidhhwcuhisuptgonyfd.supabase.co',
            supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpZGhod2N1aGlzdXB0Z29ueWZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyOTgxNDksImV4cCI6MjA4Njg3NDE0OX0.fb7FGMAEOHhyYpsTpzJ9ZGZpwQaA8INnHtq9NiHqCwU',
            defaultLanguage: 'en'
        };

        // ==========================================
        // STATE MANAGEMENT - OPTIMIZED
        // ==========================================
        const state = {
            user: null,
            session: null,
            trades: [],
            projects: [],
            currentEditId: null,
            currentDetailId: null,
            currentCalendarDate: new Date(),
            language: localStorage.getItem('violet_language') || CONFIG.defaultLanguage,
            charts: {},
            renderedSections: {
                dashboard: false,
                analytics: false
            },
            updateTimeout: null,
            supabase: null
        };

        // ==========================================
        // TRANSLATIONS
        // ==========================================
        const i18n = {
            en: {
                loading: 'Initializing Violet',
                loadingSub: 'Loading your trading data...',
                menu: 'Menu',
                system: 'System',
                dashboard: 'Dashboard',
                analytics: 'Analytics',
                goals: 'Targets',
                settings: 'Settings',
                online: 'Online',
                trader: 'Trader',
                switchApp: 'Switch Application',
                trading: 'Trading',
                budget: 'Budget',
                searchPlaceholder: 'Search trades, symbols...',
                dashboardTitle: 'Dashboard Overview',
                dashboardSubtitle: 'Track your trading performance in real-time',
                totalTrades: 'Total Trades',
                winRate: 'Win Rate',
                totalPnL: 'Total P&L',
                profitFactor: 'Profit Factor',
                riskRatio: 'Risk Ratio',
                performanceChart: 'Performance Overview',
                last7Days: 'Last 7 Days',
                last30Days: 'Last 30 Days',
                last3Months: 'Last 3 Months',
                thisYear: 'This Year',
                topSymbols: 'Top Symbols',
                winLossRatio: 'Win/Loss Distribution',
                recentTrades: 'Recent Trades',
                addTrade: 'Add Trade',
                noTrades: 'No trades yet',
                startTrading: 'Add your first trade to get started',
                tradingCalendar: 'Trading Calendar',
                analyticsTitle: 'Advanced Analytics',
                analyticsSubtitle: 'Deep dive into your trading metrics',
                avgWin: 'Avg Win',
                avgLoss: 'Avg Loss',
                expectancy: 'Expectancy',
                maxDrawdown: 'Max Drawdown',
                equityCurve: 'Equity Curve',
                monthlyPerformance: 'Monthly Performance',
                performanceByDay: 'Performance by Day',
                riskReward: 'Risk:Reward Analysis',
                goalsTitle: 'Trading Goals',
                goalsSubtitle: 'Set and track your trading targets',
                addGoal: 'Add Goal',
                noGoals: 'No goals set yet',
                createGoal: 'Create your first trading goal',
                settingsTitle: 'Settings',
                settingsSubtitle: 'Customize your experience',
                localization: 'Localization',
                language: 'Language',
                languageDesc: 'Choose your preferred language',
                notifications: 'Notifications',
                tradeAlerts: 'Trade Alerts',
                tradeAlertsDesc: 'Show notifications for new trades',
                dailySummary: 'Daily Summary',
                dailySummaryDesc: 'Receive daily trading summary',
                privacy: 'Privacy & Security',
                session: 'Session',
                sessionDesc: 'Manage your active session',
                logout: 'Logout',
                result: 'Result',
                selectResult: 'Select Result',
                symbol: 'Symbol',
                openDate: 'Open Date',
                type: 'Type',
                selectType: 'Select Type',
                side: 'Side',
                selectSide: 'Select Side',
                timeFrame: 'Time Frame',
                selectTF: 'Select TF',
                riskReward: 'Risk:Reward',
                selectRR: 'Select R:R',
                pnl: 'P&L (USD)',
                imageBefore: 'Screenshot Before',
                imageAfter: 'Screenshot After',
                note: 'Note / Analysis',
                cancel: 'Cancel',
                saveTrade: 'Save Trade',
                tradeDetails: 'Trade Details',
                close: 'Close',
                editTrade: 'Edit Trade',
                goalTitle: 'Goal Title',
                description: 'Description',
                targets: 'Targets (one per line)',
                saveGoal: 'Save Goal',
                win: 'Win',
                loss: 'Loss',
                breakeven: 'Breakeven'
            },
            id: {
                loading: 'Memulai Violet',
                loadingSub: 'Memuat data trading Anda...',
                menu: 'Menu',
                system: 'Sistem',
                dashboard: 'Dasbor',
                analytics: 'Analitik',
                goals: 'Target',
                settings: 'Pengaturan',
                online: 'Online',
                trader: 'Trader',
                switchApp: 'Ganti Aplikasi',
                trading: 'Trading',
                budget: 'Anggaran',
                searchPlaceholder: 'Cari trading, simbol...',
                dashboardTitle: 'Ikhtisar Dasbor',
                dashboardSubtitle: 'Pantau performa trading Anda real-time',
                totalTrades: 'Total Trading',
                winRate: 'Tingkat Menang',
                totalPnL: 'Total P&L',
                profitFactor: 'Faktor Profit',
                riskRatio: 'Rasio Risiko',
                performanceChart: 'Ikhtisar Performa',
                last7Days: '7 Hari Terakhir',
                last30Days: '30 Hari Terakhir',
                last3Months: '3 Bulan Terakhir',
                thisYear: 'Tahun Ini',
                topSymbols: 'Simbol Teratas',
                winLossRatio: 'Distribusi Menang/Kalah',
                recentTrades: 'Trading Terbaru',
                addTrade: 'Tambah Trading',
                noTrades: 'Belum ada trading',
                startTrading: 'Tambahkan trading pertama Anda',
                tradingCalendar: 'Kalender Trading',
                analyticsTitle: 'Analitik Lanjutan',
                analyticsSubtitle: 'Analisis mendalam metrik trading Anda',
                avgWin: 'Rata-rata Menang',
                avgLoss: 'Rata-rata Kalah',
                expectancy: 'Ekspektasi',
                maxDrawdown: 'Drawdown Maks',
                equityCurve: 'Kurva Ekuitas',
                monthlyPerformance: 'Performa Bulanan',
                performanceByDay: 'Performa per Hari',
                riskReward: 'Analisis Risk:Reward',
                goalsTitle: 'Target Trading',
                goalsSubtitle: 'Atur dan pantau target trading Anda',
                addGoal: 'Tambah Target',
                noGoals: 'Belum ada target',
                createGoal: 'Buat target trading pertama Anda',
                settingsTitle: 'Pengaturan',
                settingsSubtitle: 'Sesuaikan pengalaman Anda',
                localization: 'Lokalisasi',
                language: 'Bahasa',
                languageDesc: 'Pilih bahasa yang Anda sukai',
                notifications: 'Notifikasi',
                tradeAlerts: 'Alert Trading',
                tradeAlertsDesc: 'Tampilkan notifikasi untuk trading baru',
                dailySummary: 'Ringkasan Harian',
                dailySummaryDesc: 'Terima ringkasan trading harian',
                privacy: 'Privasi & Keamanan',
                session: 'Sesi',
                sessionDesc: 'Kelola sesi aktif Anda',
                logout: 'Keluar',
                result: 'Hasil',
                selectResult: 'Pilih Hasil',
                symbol: 'Simbol',
                openDate: 'Tanggal Buka',
                type: 'Tipe',
                selectType: 'Pilih Tipe',
                side: 'Sisi',
                selectSide: 'Pilih Sisi',
                timeFrame: 'Time Frame',
                selectTF: 'Pilih TF',
                riskReward: 'Risk:Reward',
                selectRR: 'Pilih R:R',
                pnl: 'P&L (USD)',
                imageBefore: 'Screenshot Sebelum',
                imageAfter: 'Screenshot Sesudah',
                note: 'Catatan / Analisis',
                cancel: 'Batal',
                saveTrade: 'Simpan Trading',
                tradeDetails: 'Detail Trading',
                close: 'Tutup',
                editTrade: 'Edit Trading',
                goalTitle: 'Judul Target',
                description: 'Deskripsi',
                targets: 'Target (satu per baris)',
                saveGoal: 'Simpan Target',
                win: 'Menang',
                loss: 'Kalah',
                breakeven: 'Imbang'
            }
        };

        // ==========================================
        // INITIALIZATION - OPTIMIZED
        // ==========================================
        document.addEventListener('DOMContentLoaded', async () => {
            initSupabase();
            await checkSession();
            setupEventListeners();
            applyLanguage(state.language);
        });

        function initSupabase() {
            const { createClient } = supabase;
            state.supabase = createClient(CONFIG.supabaseUrl, CONFIG.supabaseKey);
        }

        async function checkSession() {
            try {
                const { data: { session }, error } = await state.supabase.auth.getSession();
                if (error) throw error;
                
                if (session) {
                    state.session = session;
                    state.user = session.user;
                    await initializeApp();
                } else {
                    window.location.href = 'index.html';
                }

                state.supabase.auth.onAuthStateChange((event, session) => {
                    if (event === 'SIGNED_IN' && session) {
                        state.session = session;
                        state.user = session.user;
                        initializeApp();
                    } else if (event === 'SIGNED_OUT') {
                        window.location.href = 'index.html';
                    }
                });
            } catch (error) {
                console.error('Session error:', error);
                showNotification('Authentication error', 'error');
            }
        }

        // OPTIMIZED: Fast initialization with lazy loading
        async function initializeApp() {
            // Update UI immediately
            updateUserUI();
            
            // Hide loading screen early for perceived performance
            hideLoading();
            
            // Load data in background
            try {
                await Promise.all([loadTrades(), loadProjects()]);
                
                // Render dashboard first (priority)
                updateStats();
                renderDashboardCharts();
                renderTable();
                renderCalendar();
                renderProjects();
                
                // Setup realtime after initial render
                setupRealtime();
            } catch (error) {
                console.error('Initialization error:', error);
            }
        }

        function hideLoading() {
            const loader = document.getElementById('loading-screen');
            loader.classList.add('hidden');
        }

        // ==========================================
        // UI UPDATES
        // ==========================================
        function updateUserUI() {
            const email = state.user.email || 'trader@violet.com';
            const name = state.user.user_metadata?.full_name || email.split('@')[0];
            const initials = name.substring(0, 2).toUpperCase();

            const elements = {
                'sidebarAvatar': initials,
                'sidebarName': name,
                'dropdownAvatar': initials,
                'dropdownName': name,
                'dropdownEmail': email
            };

            Object.entries(elements).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            });
        }

        // ==========================================
        // DATA OPERATIONS
        // ==========================================
        async function loadTrades() {
            try {
                const { data, error } = await state.supabase
                    .from('trades')
                    .select('*')
                    .eq('user_id', state.user.id)
                    .order('open_date', { ascending: false });

                if (error) throw error;
                state.trades = data || [];
            } catch (error) {
                console.error('Load trades error:', error);
                showNotification('Failed to load trades', 'error');
            }
        }

        async function loadProjects() {
            try {
                const { data, error } = await state.supabase
                    .from('projects')
                    .select('*')
                    .eq('user_id', state.user.id)
                    .order('created_at', { ascending: false });

                if (error) throw error;
                state.projects = data || [];
            } catch (error) {
                console.error('Load projects error:', error);
            }
        }

        function setupRealtime() {
            state.supabase
                .channel('trades_changes')
                .on('postgres_changes', {
                    event: '*',
                    schema: 'public',
                    table: 'trades',
                    filter: `user_id=eq.${state.user.id}`
                }, handleRealtimeUpdate)
                .subscribe();
        }

        // OPTIMIZED: Debounced realtime updates
        function handleRealtimeUpdate(payload) {
            clearTimeout(state.updateTimeout);
            state.updateTimeout = setTimeout(() => {
                const { eventType, new: newRecord, old: oldRecord } = payload;

                switch(eventType) {
                    case 'INSERT':
                        if (!state.trades.find(t => t.id === newRecord.id)) {
                            state.trades.unshift(newRecord);
                        }
                        break;
                    case 'UPDATE':
                        const idx = state.trades.findIndex(t => t.id === oldRecord.id);
                        if (idx !== -1) state.trades[idx] = newRecord;
                        break;
                    case 'DELETE':
                        state.trades = state.trades.filter(t => t.id !== oldRecord.id);
                        break;
                }
                
                // Only re-render if on dashboard
                if (document.getElementById('dashboard-content').classList.contains('active')) {
                    updateStats();
                    renderDashboardCharts();
                    renderTable();
                    renderCalendar();
                }
            }, 300);
        }

        // ==========================================
        // RENDERING - OPTIMIZED WITH LAZY LOADING
        // ==========================================
        function updateStats() {
            const trades = state.trades;
            const total = trades.length;
            const wins = trades.filter(t => t.result === 'WIN').length;
            const losses = trades.filter(t => t.result === 'LOSS').length;
            const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;
            const totalPnL = trades.reduce((sum, t) => sum + (parseFloat(t.pnl) || 0), 0);
            
            const grossProfit = trades
                .filter(t => parseFloat(t.pnl) > 0)
                .reduce((sum, t) => sum + parseFloat(t.pnl), 0);
            const grossLoss = Math.abs(trades
                .filter(t => parseFloat(t.pnl) < 0)
                .reduce((sum, t) => sum + parseFloat(t.pnl), 0));
            const profitFactor = grossLoss > 0 ? (grossProfit / grossLoss).toFixed(2) : 
                                grossProfit > 0 ? '' : '-';

            document.getElementById('totalTrades').textContent = total;
            document.getElementById('winRate').textContent = winRate + '%';
            document.getElementById('totalPnL').textContent = formatCurrency(totalPnL);
            document.getElementById('profitFactor').textContent = profitFactor;

            document.getElementById('totalTradesTrend').textContent = `${total} trades`;
            const winRateTrend = document.getElementById('winRateTrend');
            winRateTrend.textContent = winRate >= 50 ? 'Good' : 'Improve';
            winRateTrend.className = 'stat-change ' + (winRate >= 50 ? 'positive' : 'negative');
            
            const pnlTrend = document.getElementById('pnlTrend');
            pnlTrend.textContent = (totalPnL >= 0 ? '+' : '') + formatCurrency(totalPnL);
            pnlTrend.className = 'stat-change ' + (totalPnL >= 0 ? 'positive' : 'negative');

            const pnlCard = document.getElementById('pnlCard');
            pnlCard.className = 'stat-card ' + (totalPnL >= 0 ? 'win' : 'loss');
        }

        // OPTIMIZED: Only render dashboard charts initially
        function renderDashboardCharts() {
            renderMainChart();
            renderSymbolChart();
            renderDistributionChart();
            state.renderedSections.dashboard = true;
        }

        // OPTIMIZED: Lazy load analytics charts
        function renderAnalyticsChartsLazy() {
            if (state.renderedSections.analytics) return;
            
            // Use requestAnimationFrame for smooth rendering
            requestAnimationFrame(() => {
                updateAnalyticsMetrics();
                renderEquityChart();
                renderMonthlyChart();
                renderDayChart();
                renderRRChart();
                state.renderedSections.analytics = true;
            });
        }

        function updateAnalyticsMetrics() {
            const winTrades = state.trades.filter(t => t.result === 'WIN' && parseFloat(t.pnl) > 0);
            const lossTrades = state.trades.filter(t => t.result === 'LOSS' && parseFloat(t.pnl) < 0);
            
            const avgWin = winTrades.length > 0 
                ? winTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / winTrades.length 
                : 0;
            const avgLoss = lossTrades.length > 0 
                ? Math.abs(lossTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / lossTrades.length)
                : 0;
            
            const winRate = state.trades.length > 0 ? (winTrades.length / state.trades.length) : 0;
            const lossRate = state.trades.length > 0 ? (lossTrades.length / state.trades.length) : 0;
            const expectancy = (winRate * avgWin) - (lossRate * avgLoss);
            
            let maxDrawdown = 0;
            let peak = 0;
            let runningPnL = 0;
            
            const sorted = [...state.trades].sort((a, b) => 
                new Date(a.open_date) - new Date(b.open_date)
            );
            
            sorted.forEach(trade => {
                runningPnL += parseFloat(trade.pnl) || 0;
                if (runningPnL > peak) peak = runningPnL;
                const drawdown = peak - runningPnL;
                if (drawdown > maxDrawdown) maxDrawdown = drawdown;
            });

            document.getElementById('avgWin').textContent = formatCurrency(avgWin);
            document.getElementById('avgLoss').textContent = formatCurrency(avgLoss);
            document.getElementById('expectancy').textContent = formatCurrency(expectancy);
            document.getElementById('expectancy').className = 'metric-value mono ' + (expectancy >= 0 ? 'positive' : 'negative');
            document.getElementById('maxDrawdown').textContent = formatCurrency(maxDrawdown);
        }

        // ==========================================
        // CHARTS - OPTIMIZED WITH VIOLET THEME
        // ==========================================
        function renderMainChart() {
            const days = state.language === 'en' 
                ? ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                : ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min'];
                
            const tradesByDay = new Array(7).fill(0);
            const pnlByDay = new Array(7).fill(0);
            
            state.trades.forEach(trade => {
                const date = new Date(trade.open_date);
                const dayIndex = date.getDay();
                const adjustedIndex = dayIndex === 0 ? 6 : dayIndex - 1;
                tradesByDay[adjustedIndex]++;
                pnlByDay[adjustedIndex] += parseFloat(trade.pnl) || 0;
            });

            const options = {
                series: [{
                    name: 'Trades',
                    type: 'column',
                    data: tradesByDay
                }, {
                    name: 'P&L',
                    type: 'area',
                    data: pnlByDay
                }],
                chart: {
                    height: 300,
                    type: 'line',
                    background: 'transparent',
                    toolbar: { show: false },
                    fontFamily: 'Plus Jakarta Sans, sans-serif',
                    animations: { enabled: false } // Disable for performance
                },
                stroke: { width: [0, 2], curve: 'smooth' },
                plotOptions: {
                    bar: { columnWidth: '40%', borderRadius: 4 }
                },
                colors: ['#8b5cf6', '#00ff88'], // Violet theme
                fill: {
                    type: ['solid', 'gradient'],
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.3,
                        opacityTo: 0.05,
                        stops: [0, 100]
                    }
                },
                dataLabels: { enabled: false },
                grid: {
                    borderColor: 'rgba(255,255,255,0.05)',
                    strokeDashArray: 3
                },
                xaxis: {
                    categories: days,
                    labels: { style: { colors: '#a0a0b0' } },
                    axisBorder: { show: false },
                    axisTicks: { show: false }
                },
                yaxis: [{
                    labels: { 
                        style: { colors: '#a0a0b0' },
                        formatter: (val) => Math.round(val)
                    }
                }, {
                    opposite: true,
                    labels: { 
                        style: { colors: '#606070' },
                        formatter: (val) => '$' + val.toFixed(0)
                    }
                }],
                legend: { 
                    show: true,
                    labels: { colors: '#a0a0b0' }
                },
                tooltip: {
                    theme: 'dark',
                    style: {
                        fontSize: '12px'
                    }
                }
            };

            if (state.charts.main) state.charts.main.destroy();
            state.charts.main = new ApexCharts(document.querySelector("#mainChart"), options);
            state.charts.main.render();
        }

        function renderSymbolChart() {
            const symbolPnL = {};
            state.trades.forEach(trade => {
                const symbol = trade.symbol?.toUpperCase() || 'Unknown';
                symbolPnL[symbol] = (symbolPnL[symbol] || 0) + (parseFloat(trade.pnl) || 0);
            });

            const sorted = Object.entries(symbolPnL)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const options = {
                series: [{ data: sorted.map(s => s[1]) }],
                chart: {
                    type: 'bar',
                    height: 250,
                    background: 'transparent',
                    toolbar: { show: false }
                },
                plotOptions: {
                    bar: {
                        borderRadius: 4,
                        horizontal: true,
                        colors: {
                            ranges: [{
                                from: -999999,
                                to: 0,
                                color: '#ff0044'
                            }, {
                                from: 0,
                                to: 999999,
                                color: '#00ff88'
                            }]
                        }
                    }
                },
                dataLabels: { enabled: false },
                grid: {
                    borderColor: 'rgba(255,255,255,0.05)',
                    strokeDashArray: 3
                },
                xaxis: {
                    categories: sorted.map(s => s[0]),
                    labels: { style: { colors: '#a0a0b0' } }
                },
                yaxis: {
                    labels: { style: { colors: '#a0a0b0' } }
                },
                tooltip: { theme: 'dark' }
            };

            if (state.charts.symbols) state.charts.symbols.destroy();
            state.charts.symbols = new ApexCharts(document.querySelector("#symbolsChart"), options);
            state.charts.symbols.render();
        }

        function renderDistributionChart() {
            const wins = state.trades.filter(t => t.result === 'WIN').length;
            const losses = state.trades.filter(t => t.result === 'LOSS').length;
            const breakeven = state.trades.filter(t => t.result === 'BREAKEVEN').length;

            const options = {
                series: [wins, losses, breakeven],
                chart: {
                    type: 'donut',
                    height: 250,
                    background: 'transparent'
                },
                labels: ['Win', 'Loss', 'Breakeven'],
                colors: ['#00ff88', '#ff0044', '#ffaa00'],
                plotOptions: {
                    pie: {
                        donut: {
                            size: '65%',
                            labels: {
                                show: true,
                                name: { show: false },
                                value: {
                                    show: true,
                                    fontSize: '20px',
                                    fontWeight: 700,
                                    color: '#ffffff',
                                    formatter: (val) => val
                                },
                                total: {
                                    show: true,
                                    label: 'Total',
                                    color: '#606070',
                                    formatter: () => state.trades.length
                                }
                            }
                        }
                    }
                },
                dataLabels: { enabled: false },
                legend: {
                    position: 'bottom',
                    labels: { colors: '#a0a0b0' }
                },
                tooltip: { theme: 'dark' }
            };

            if (state.charts.distribution) state.charts.distribution.destroy();
            state.charts.distribution = new ApexCharts(document.querySelector("#distributionChart"), options);
            state.charts.distribution.render();
        }

        // Analytics Charts - Lazy Loaded
        function renderEquityChart() {
            let runningPnL = 0;
            const equityData = state.trades
                .sort((a, b) => new Date(a.open_date) - new Date(b.open_date))
                .map(trade => {
                    runningPnL += parseFloat(trade.pnl) || 0;
                    return runningPnL;
                });

            const options = {
                series: [{ data: equityData }],
                chart: {
                    type: 'area',
                    height: 250,
                    background: 'transparent',
                    toolbar: { show: false }
                },
                colors: ['#8b5cf6'],
                fill: {
                    type: 'gradient',
                    gradient: {
                        shadeIntensity: 1,
                        opacityFrom: 0.3,
                        opacityTo: 0.05
                    }
                },
                stroke: { curve: 'smooth', width: 2 },
                grid: {
                    borderColor: 'rgba(255,255,255,0.05)',
                    strokeDashArray: 3
                },
                xaxis: {
                    labels: { show: false },
                    axisBorder: { show: false },
                    axisTicks: { show: false }
                },
                yaxis: {
                    labels: { style: { colors: '#a0a0b0' } }
                },
                dataLabels: { enabled: false },
                tooltip: { theme: 'dark' }
            };

            if (state.charts.equity) state.charts.equity.destroy();
            state.charts.equity = new ApexCharts(document.querySelector("#equityChart"), options);
            state.charts.equity.render();
        }

        function renderMonthlyChart() {
            const monthly = {};
            state.trades.forEach(trade => {
                const date = new Date(trade.open_date);
                const key = date.toLocaleString('en-US', { month: 'short' });
                monthly[key] = (monthly[key] || 0) + (parseFloat(trade.pnl) || 0);
            });

            const options = {
                series: [{ data: Object.values(monthly) }],
                chart: {
                    type: 'bar',
                    height: 250,
                    background: 'transparent',
                    toolbar: { show: false }
                },
                plotOptions: {
                    bar: {
                        borderRadius: 4,
                        colors: {
                            ranges: [{
                                from: -999999,
                                to: 0,
                                color: '#ff0044'
                            }, {
                                from: 0,
                                to: 999999,
                                color: '#00ff88'
                            }]
                        }
                    }
                },
                grid: {
                    borderColor: 'rgba(255,255,255,0.05)',
                    strokeDashArray: 3
                },
                xaxis: {
                    categories: Object.keys(monthly),
                    labels: { style: { colors: '#a0a0b0' } }
                },
                yaxis: {
                    labels: { style: { colors: '#a0a0b0' } }
                },
                dataLabels: { enabled: false },
                tooltip: { theme: 'dark' }
            };

            if (state.charts.monthly) state.charts.monthly.destroy();
            state.charts.monthly = new ApexCharts(document.querySelector("#monthlyChart"), options);
            state.charts.monthly.render();
        }

        function renderDayChart() {
            const dayStats = {};
            const dayNames = state.language === 'en'
                ? ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                : ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
            
            dayNames.forEach(d => dayStats[d] = { win: 0, loss: 0 });
            
            state.trades.forEach(trade => {
                const dayName = dayNames[new Date(trade.open_date).getDay()];
                if (trade.result === 'WIN') dayStats[dayName].win++;
                else if (trade.result === 'LOSS') dayStats[dayName].loss++;
            });

            const options = {
                series: [
                    { name: 'Win', data: Object.values(dayStats).map(d => d.win) },
                    { name: 'Loss', data: Object.values(dayStats).map(d => d.loss) }
                ],
                chart: {
                    type: 'bar',
                    height: 250,
                    background: 'transparent',
                    stacked: true,
                    toolbar: { show: false }
                },
                colors: ['#00ff88', '#ff0044'],
                plotOptions: {
                    bar: { borderRadius: 4 }
                },
                grid: {
                    borderColor: 'rgba(255,255,255,0.05)',
                    strokeDashArray: 3
                },
                xaxis: {
                    categories: Object.keys(dayStats),
                    labels: { style: { colors: '#a0a0b0' } }
                },
                yaxis: {
                    labels: { style: { colors: '#a0a0b0' } }
                },
                legend: {
                    labels: { colors: '#a0a0b0' }
                },
                tooltip: { theme: 'dark' }
            };

            if (state.charts.day) state.charts.day.destroy();
            state.charts.day = new ApexCharts(document.querySelector("#dayChart"), options);
            state.charts.day.render();
        }

        function renderRRChart() {
            const rrStats = {};
            state.trades.forEach(trade => {
                const rr = trade.risk_reward || 'N/A';
                if (!rrStats[rr]) rrStats[rr] = { win: 0, total: 0 };
                rrStats[rr].total++;
                if (trade.result === 'WIN') rrStats[rr].win++;
            });

            const options = {
                series: [{
                    name: 'Win Rate %',
                    data: Object.values(rrStats).map(s => (s.win / s.total * 100).toFixed(1))
                }],
                chart: {
                    type: 'bar',
                    height: 250,
                    background: 'transparent',
                    toolbar: { show: false }
                },
                colors: ['#8b5cf6'],
                plotOptions: {
                    bar: { borderRadius: 4 }
                },
                grid: {
                    borderColor: 'rgba(255,255,255,0.05)',
                    strokeDashArray: 3
                },
                xaxis: {
                    categories: Object.keys(rrStats),
                    labels: { style: { colors: '#a0a0b0' } }
                },
                yaxis: {
                    labels: { 
                        style: { colors: '#606070' },
                        formatter: (val) => val + '%'
                    }
                },
                dataLabels: { enabled: false },
                tooltip: { theme: 'dark' }
            };

            if (state.charts.rr) state.charts.rr.destroy();
            state.charts.rr = new ApexCharts(document.querySelector("#rrChart"), options);
            state.charts.rr.render();
        }

        // ==========================================
        // TABLE RENDERING
        // ==========================================
        function renderTable() {
            const container = document.getElementById('tradesTableContainer');
            if (!container) return;

            if (state.trades.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="fas fa-history"></i></div>
                        <h3>${t('noTrades')}</h3>
                        <p>${t('startTrading')}</p>
                    </div>
                `;
                return;
            }

            const rows = state.trades.slice(0, 10).map(trade => `
                <tr onclick="openDetailModal('${trade.id}')">
                    <td><span class="badge badge-${trade.result?.toLowerCase()}">${trade.result || '-'}</span></td>
                    <td><strong>${trade.symbol}</strong></td>
                    <td>${formatDate(trade.open_date)}</td>
                    <td>${trade.type || '-'}</td>
                    <td><span class="badge badge-side badge-${trade.side || 'buy'}">${trade.side?.toUpperCase() || '-'}</span></td>
                    <td>${trade.time_frame || '-'}</td>
                    <td>${trade.risk_reward || '-'}</td>
                    <td class="pnl-value ${trade.pnl >= 0 ? 'pnl-positive' : 'pnl-negative'}">
                        ${formatCurrency(trade.pnl)}
                    </td>
                    <td onclick="event.stopPropagation()">
                        <div class="action-btns">
                            <button class="btn-icon edit" onclick="editTrade('${trade.id}')" title="Edit">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-icon delete" onclick="deleteTrade('${trade.id}')" title="Delete">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>${t('result')}</th>
                            <th>${t('symbol')}</th>
                            <th>${t('openDate')}</th>
                            <th>${t('type')}</th>
                            <th>${t('side')}</th>
                            <th>TF</th>
                            <th>R:R</th>
                            <th>P&L</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>${rows}</tbody>
                </table>
            `;
        }

        // ==========================================
        // CALENDAR
        // ==========================================
        function renderCalendar() {
            const year = state.currentCalendarDate.getFullYear();
            const month = state.currentCalendarDate.getMonth();
            
            const monthNames = state.language === 'en' 
                ? ['January', 'February', 'March', 'April', 'May', 'June', 
                   'July', 'August', 'September', 'October', 'November', 'December']
                : ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                   'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            document.getElementById('calendarMonth').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysInPrevMonth = new Date(year, month, 0).getDate();
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const dayNames = state.language === 'en'
                ? ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
                : ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
            
            dayNames.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-day-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            for (let i = firstDay - 1; i >= 0; i--) {
                const div = createDayElement(daysInPrevMonth - i, true);
                grid.appendChild(div);
            }
            
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const isToday = today.getDate() === day && 
                               today.getMonth() === month && 
                               today.getFullYear() === year;
                const div = createDayElement(day, false, isToday, year, month);
                grid.appendChild(div);
            }
            
            const remaining = 42 - (firstDay + daysInMonth);
            for (let day = 1; day <= remaining; day++) {
                const div = createDayElement(day, true);
                grid.appendChild(div);
            }
        }

        function createDayElement(day, isOtherMonth, isToday = false, year = null, month = null) {
            const div = document.createElement('div');
            div.className = 'calendar-day' + (isOtherMonth ? ' other-month' : '') + (isToday ? ' today' : '');
            
            const num = document.createElement('div');
            num.className = 'day-number';
            num.textContent = day;
            div.appendChild(num);
            
            if (!isOtherMonth && year !== null) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayTrades = state.trades.filter(t => {
                    const tradeDate = new Date(t.open_date);
                    return tradeDate.toISOString().split('T')[0] === dateStr;
                });
                
                if (dayTrades.length > 0) {
                    const netPnL = dayTrades.reduce((sum, t) => sum + (parseFloat(t.pnl) || 0), 0);
                    
                    if (netPnL > 0) div.classList.add('win');
                    else if (netPnL < 0) div.classList.add('loss');
                    
                    const pnlDiv = document.createElement('div');
                    pnlDiv.className = 'day-pnl ' + (netPnL >= 0 ? 'positive' : 'negative');
                    pnlDiv.textContent = (netPnL >= 0 ? '+' : '') + formatCurrencyShort(netPnL);
                    div.appendChild(pnlDiv);
                    
                    div.onclick = () => showDayTrades(dateStr);
                }
            }
            
            return div;
        }

        function changeMonth(delta) {
            state.currentCalendarDate.setMonth(state.currentCalendarDate.getMonth() + delta);
            renderCalendar();
        }

        // ==========================================
        // PROJECTS
        // ==========================================
        function renderProjects() {
            const container = document.getElementById('projectsGrid');
            if (!container) return;

            if (state.projects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon"><i class="fas fa-bullseye"></i></div>
                        <h3>${t('noGoals')}</h3>
                        <p>${t('createGoal')}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = state.projects.map(project => {
                const progress = project.progress || 0;
                const targets = project.targets || [];
                
                return `
                    <div class="project-card">
                        <div class="project-header">
                            <h3 class="project-title">${project.title}</h3>
                            <span class="project-status ${project.status}">${project.status}</span>
                        </div>
                        <p class="project-desc">${project.description || ''}</p>
                        <div class="targets-list">
                            ${targets.map((target, idx) => `
                                <div class="target-item ${target.completed ? 'completed' : ''}" 
                                     onclick="toggleTarget('${project.id}', ${idx})">
                                    <div class="target-checkbox"></div>
                                    <span class="target-text">${target.text}</span>
                                </div>
                            `).join('')}
                        </div>
                        <div class="project-footer">
                            <div class="progress-info">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                                <span>${progress}%</span>
                            </div>
                            <button class="btn-icon delete" onclick="deleteProject('${project.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ==========================================
        // MODAL HANDLERS
        // ==========================================
        function openTradeModal(editId = null) {
            const modal = document.getElementById('tradeModal');
            const form = document.getElementById('tradeForm');
            const title = document.getElementById('tradeModalTitle');
            
            modal.classList.add('active');
            form.reset();
            
            if (editId) {
                state.currentEditId = editId;
                title.textContent = t('editTrade');
                const trade = state.trades.find(t => t.id === editId);
                if (trade) fillTradeForm(trade);
            } else {
                state.currentEditId = null;
                title.textContent = t('addTrade');
                const now = new Date();
                now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
                form.open_date.value = now.toISOString().slice(0, 16);
            }
        }

        function closeTradeModal() {
            document.getElementById('tradeModal').classList.remove('active');
            state.currentEditId = null;
        }

        function fillTradeForm(trade) {
            const form = document.getElementById('tradeForm');
            form.result.value = trade.result || '';
            form.symbol.value = trade.symbol || '';
            form.open_date.value = trade.open_date ? trade.open_date.slice(0, 16) : '';
            form.type.value = trade.type || '';
            form.side.value = trade.side || '';
            form.time_frame.value = trade.time_frame || '';
            form.risk_reward.value = trade.risk_reward || '';
            form.pnl.value = trade.pnl || '';
            form.image_before.value = trade.image_before || '';
            form.image_after.value = trade.image_after || '';
            form.note.value = trade.note || '';
        }

        function openDetailModal(id) {
            state.currentDetailId = id;
            const trade = state.trades.find(t => t.id === id);
            if (!trade) return;

            const modal = document.getElementById('detailModal');
            const content = document.getElementById('detailContent');
            
            const pnlClass = trade.pnl > 0 ? 'positive' : trade.pnl < 0 ? 'negative' : '';
            const pnlSign = trade.pnl > 0 ? '+' : '';
            
            let imagesHtml = '';
            if (trade.image_before || trade.image_after) {
                imagesHtml = `
                    <div class="detail-item full-width">
                        <div class="detail-label">Screenshots</div>
                        <div class="detail-images">
                            ${trade.image_before ? `
                                <a href="${trade.image_before}" target="_blank" class="detail-image-link">
                                    <i class="fas fa-image"></i> Before
                                </a>
                            ` : ''}
                            ${trade.image_after ? `
                                <a href="${trade.image_after}" target="_blank" class="detail-image-link">
                                    <i class="fas fa-image"></i> After
                                </a>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            content.innerHTML = `
                <div class="detail-grid">
                    <div class="detail-item">
                        <div class="detail-label">Result</div>
                        <div class="detail-value">
                            <span class="badge badge-${trade.result?.toLowerCase()}">${trade.result || '-'}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Symbol</div>
                        <div class="detail-value" style="font-size: 1.1rem;">${trade.symbol || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Type</div>
                        <div class="detail-value">${trade.type || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Side</div>
                        <div class="detail-value">
                            <span class="badge badge-side badge-${trade.side || 'buy'}">${trade.side?.toUpperCase() || '-'}</span>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Open Date</div>
                        <div class="detail-value">${formatDateTime(trade.open_date)}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Time Frame</div>
                        <div class="detail-value">${trade.time_frame || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Risk:Reward</div>
                        <div class="detail-value">${trade.risk_reward || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">P&L</div>
                        <div class="detail-value ${pnlClass}" style="font-size: 1.1rem;">
                            ${pnlSign}${formatCurrency(trade.pnl)}
                        </div>
                    </div>
                    ${imagesHtml}
                    ${trade.note ? `
                        <div class="detail-item full-width">
                            <div class="detail-label">Note</div>
                            <div class="detail-note">${escapeHtml(trade.note)}</div>
                        </div>
                    ` : ''}
                </div>
            `;
            
            modal.classList.add('active');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('active');
            state.currentDetailId = null;
        }

        function editCurrentTrade() {
            if (state.currentDetailId) {
                closeDetailModal();
                openTradeModal(state.currentDetailId);
            }
        }

        function openProjectModal() {
            document.getElementById('projectModal').classList.add('active');
            document.getElementById('projectForm').reset();
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.remove('active');
        }

        // ==========================================
        // CRUD OPERATIONS
        // ==========================================
        async function saveTrade(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            
            let pnl = parseFloat(formData.get('pnl')) || 0;
            const result = formData.get('result');
            
            if (result === 'BREAKEVEN') pnl = 0;
            else if (result === 'WIN' && pnl < 0) pnl = Math.abs(pnl);
            else if (result === 'LOSS' && pnl > 0) pnl = -Math.abs(pnl);
            
            const tradeData = {
                user_id: state.user.id,
                result: result,
                symbol: formData.get('symbol').toUpperCase(),
                open_date: formData.get('open_date'),
                type: formData.get('type'),
                side: formData.get('side'),
                time_frame: formData.get('time_frame') || null,
                risk_reward: formData.get('risk_reward') || null,
                pnl: pnl,
                image_before: formData.get('image_before') || null,
                image_after: formData.get('image_after') || null,
                note: formData.get('note') || null
            };

            try {
                if (state.currentEditId) {
                    const { data, error } = await state.supabase
                        .from('trades')
                        .update(tradeData)
                        .eq('id', state.currentEditId)
                        .select();
                    if (error) throw error;
                    
                    const idx = state.trades.findIndex(t => t.id === state.currentEditId);
                    if (idx !== -1) state.trades[idx] = data[0];
                    
                    showNotification('Trade updated', 'success');
                } else {
                    const { data, error } = await state.supabase
                        .from('trades')
                        .insert([tradeData])
                        .select();
                    if (error) throw error;
                    
                    state.trades.unshift(data[0]);
                    showNotification('Trade added', 'success');
                }
                
                closeTradeModal();
                updateStats();
                renderDashboardCharts();
                renderTable();
                renderCalendar();
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function editTrade(id) {
            openTradeModal(id);
        }

        async function deleteTrade(id) {
            if (!confirm('Delete this trade?')) return;
            
            try {
                const { error } = await state.supabase
                    .from('trades')
                    .delete()
                    .eq('id', id);
                
                if (error) throw error;
                
                state.trades = state.trades.filter(t => t.id !== id);
                updateStats();
                renderDashboardCharts();
                renderTable();
                renderCalendar();
                showNotification('Trade deleted', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function saveProject(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            
            const targetsText = formData.get('targets') || '';
            const targets = targetsText.split('\n')
                .map(t => t.trim())
                .filter(t => t)
                .map(t => ({ text: t, completed: false }));
            
            const projectData = {
                user_id: state.user.id,
                title: formData.get('title'),
                description: formData.get('description'),
                status: 'active',
                targets: targets.length > 0 ? targets : [{ text: 'Complete goal', completed: false }],
                progress: 0
            };

            try {
                const { data, error } = await state.supabase
                    .from('projects')
                    .insert([projectData])
                    .select();
                
                if (error) throw error;
                
                state.projects.unshift(data[0]);
                closeProjectModal();
                renderProjects();
                showNotification('Goal created', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function toggleTarget(projectId, targetIdx) {
            const project = state.projects.find(p => p.id === projectId);
            if (!project?.targets) return;
            
            project.targets[targetIdx].completed = !project.targets[targetIdx].completed;
            const completed = project.targets.filter(t => t.completed).length;
            project.progress = Math.round((completed / project.targets.length) * 100);
            
            try {
                await state.supabase
                    .from('projects')
                    .update({ targets: project.targets, progress: project.progress })
                    .eq('id', projectId);
                
                renderProjects();
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        async function deleteProject(id) {
            if (!confirm('Delete this goal?')) return;
            
            try {
                await state.supabase.from('projects').delete().eq('id', id);
                state.projects = state.projects.filter(p => p.id !== id);
                renderProjects();
                showNotification('Goal deleted', 'success');
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // ==========================================
        // NAVIGATION & UI - OPTIMIZED
        // ==========================================
        function switchSection(section, contentId) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
            document.getElementById(contentId).classList.add('active');

            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.toggle('active', el.dataset.section === section);
            });

            const pageTitle = document.getElementById('pageTitle');
            if (pageTitle) {
                const titles = {
                    'dashboard': 'Dashboard',
                    'analytics': 'Analytics',
                    'projects': 'Trading Goals',
                    'settings': 'Settings'
                };
                pageTitle.textContent = titles[section] || 'Violet';
            }

            // OPTIMIZED: Lazy load analytics charts when tab opened
            if (section === 'analytics' && !state.renderedSections.analytics) {
                setTimeout(renderAnalyticsChartsLazy, 100);
            }

            closeProfileDropdown();
        }

        function toggleProfileDropdown() {
            const container = document.getElementById('profileDropdownContainer');
            container.classList.toggle('active');
        }

        function closeProfileDropdown() {
            const container = document.getElementById('profileDropdownContainer');
            if (container) container.classList.remove('active');
        }

        function switchApp(app) {
            if (app === 'budget') {
                window.location.href = 'budget.html';
            }
        }

        // ==========================================
        // LANGUAGE
        // ==========================================
        function setLanguage(lang) {
            state.language = lang;
            localStorage.setItem('violet_language', lang);
            applyLanguage(lang);
            
            // Re-render charts with new language
            if (state.renderedSections.dashboard) {
                renderDashboardCharts();
            }
            if (state.renderedSections.analytics) {
                renderAnalyticsChartsLazy();
            }
            renderCalendar();
            
            showNotification(lang === 'en' ? 'Language updated' : 'Bahasa diperbarui', 'success');
        }

        function toggleLanguage() {
            setLanguage(state.language === 'en' ? 'id' : 'en');
            closeProfileDropdown();
        }

        function applyLanguage(lang) {
            const texts = i18n[lang];
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (texts[key]) el.textContent = texts[key];
            });
            
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (texts[key]) el.placeholder = texts[key];
            });
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.id === `lang-${lang}` || btn.id === `settings-lang-${lang}`);
            });
        }

        function t(key) {
            return i18n[state.language][key] || key;
        }

        // ==========================================
        // UTILITIES
        // ==========================================
        function formatCurrency(value) {
            if (value === null || value === undefined) return '-';
            const num = parseFloat(value);
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: num % 1 === 0 ? 0 : 2,
                maximumFractionDigits: 2
            }).format(num);
        }

        function formatCurrencyShort(value) {
            const num = parseFloat(value);
            if (Math.abs(num) >= 1000) return (num / 1000).toFixed(1) + 'k';
            return num.toFixed(num % 1 === 0 ? 0 : 1);
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleDateString(state.language === 'en' ? 'en-US' : 'id-ID', {
                day: '2-digit', month: 'short', year: 'numeric'
            });
        }

        function formatDateTime(dateString) {
            if (!dateString) return '-';
            return new Date(dateString).toLocaleString(state.language === 'en' ? 'en-US' : 'id-ID', {
                day: '2-digit', month: 'short', year: 'numeric',
                hour: '2-digit', minute: '2-digit'
            });
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            
            const icons = { success: 'check-circle', error: 'times-circle', warning: 'exclamation-circle' };
            
            notif.innerHTML = `
                <div class="notification-icon"><i class="fas fa-${icons[type]}"></i></div>
                <div class="notification-content">
                    <div class="notification-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="notification-message">${message}</div>
                </div>
            `;
            
            container.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        async function logout() {
            try {
                await state.supabase.auth.signOut();
                showNotification('Logged out', 'success');
                setTimeout(() => window.location.href = 'index.html', 1000);
            } catch (error) {
                showNotification(error.message, 'error');
            }
        }

        // ==========================================
        // EVENT LISTENERS
        // ==========================================
        function setupEventListeners() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    switchSection(item.dataset.section, item.dataset.content);
                });
            });

            document.addEventListener('click', (e) => {
                const container = document.getElementById('profileDropdownContainer');
                if (container && !container.contains(e.target)) {
                    closeProfileDropdown();
                }
            });

            document.querySelectorAll('.modal-overlay').forEach(overlay => {
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });
            });
        }
    </script>
</body>
</html>